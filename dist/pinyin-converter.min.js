!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).PinyinConverter={})}(this,function(t){"use strict";class n{constructor(){this.data={},this.loaded=!1,this.CJK_RANGES=[[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471]]}static getInstance(){return n.instance||(n.instance=new n),n.instance}async loadData(){if(!this.loaded)try{await this.loadMandarinData(),await this.loadPinyinData(),this.loaded=!0,console.log(`拼音数据加载完成，共${Object.keys(this.data).length}个字符`)}catch(t){throw console.error("加载拼音数据失败:",t),new Error("Failed to load pinyin data")}}getData(){if(!this.loaded)throw new Error("Pinyin data not loaded. Call loadData() first.");return this.data}async loadMandarinData(){try{const t=await this.loadTextFile("./pinyin-data/kMandarin.txt");this.parseMandarinData(t)}catch(t){console.warn("无法加载kMandarin数据，将使用pinyin.txt作为主要数据源")}}async loadPinyinData(){try{const t=await this.loadTextFile("./pinyin-data/pinyin.txt");this.parsePinyinData(t)}catch(t){throw console.error("无法加载pinyin数据:",t),t}}async loadTextFile(t){if("undefined"!=typeof window){const n=await fetch(t);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return n.text()}if("undefined"!=typeof require){const n=require("fs"),e=require("path").resolve(__dirname,t);return n.readFileSync(e,"utf-8")}throw new Error("Unsupported environment")}parseMandarinData(t){const n=t.split("\n");for(const t of n){const n=t.trim();if(!n||n.startsWith("#"))continue;const e=n.match(/^U\+([0-9A-Fa-f]+):\s*(.+?)(?:\s*#.*)?$/);if(!e)continue;const i=e[1].toUpperCase(),r=e[2].split(",").map(t=>t.trim()).filter(t=>t);r.length>0&&(this.data[i]=r)}}parsePinyinData(t){const n=t.split("\n");for(const t of n){const n=t.trim();if(!n||n.startsWith("#"))continue;const e=n.match(/^U\+([0-9A-Fa-f]+):\s*(.+?)(?:\s*#.*)?$/);if(!e)continue;const i=e[1].toUpperCase(),r=e[2].split(",").map(t=>t.trim()).filter(t=>t);this.data[i]?this.data[i]=[...new Set([...this.data[i],...r])]:this.data[i]=r}}isChinese(t){if(!t||1!==t.length)return!1;const n=t.charCodeAt(0);return this.CJK_RANGES.some(([t,e])=>n>=t&&n<=e)}charToUnicode(t){return this.isChinese(t)?t.codePointAt(0).toString(16).toUpperCase().padStart(4,"0"):""}}class e{static toneMarkToNumber(t){const n={"ā":"a","á":"a","ǎ":"a","à":"a","ē":"e","é":"e","ě":"e","è":"e","ī":"i","í":"i","ǐ":"i","ì":"i","ō":"o","ó":"o","ǒ":"o","ò":"o","ū":"u","ú":"u","ǔ":"u","ù":"u","ǖ":"ü","ǘ":"ü","ǚ":"ü","ǜ":"ü","ü":"ü"};let e="",i=0;for(const r of t)if(n[r]){e+=n[r];const t=r.match(/[āáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜ]/);if(t){const n=t[0];"āēīōūǖ".includes(n)?i=1:"áéíóúǘ".includes(n)?i=2:"ǎěǐǒǔǚ".includes(n)?i=3:"àèìòùǜ".includes(n)&&(i=4)}}else e+=r;return 0===i&&e.match(/[aeiouü]/)&&(i=5),i>0&&(e+=i.toString()),e}static numberToToneMark(t){const n=t.match(/^(.+?)([1-5])$/);if(!n)return t;const[,e,i]=n,r=parseInt(i)-1;if(r<0||r>4)return e;const a=this.findToneVowel(e);return a?e.replace(a,{a:["ā","á","ǎ","à"],e:["ē","é","ě","è"],i:["ī","í","ǐ","ì"],o:["ō","ó","ǒ","ò"],u:["ū","ú","ǔ","ù"],v:["ǖ","ǘ","ǚ","ǜ"]}[a][r]):e}static removeTone(t){const n={"ā":"a","á":"a","ǎ":"a","à":"a","ē":"e","é":"e","ě":"e","è":"e","ī":"i","í":"i","ǐ":"i","ì":"i","ō":"o","ó":"o","ǒ":"o","ò":"o","ū":"u","ú":"u","ǔ":"u","ù":"u","ǖ":"ü","ǘ":"ü","ǚ":"ü","ǜ":"ü"};return t.split("").map(t=>n[t]||t).join("")}static findToneVowel(t){const n=["a","e","o","i","u","v"];if(t.includes("iu"))return"u";if(t.includes("ui"))return"i";for(const e of n)if(t.includes(e))return e;return null}static formatPinyin(t,n){switch(n){case"number":return this.toneMarkToNumber(t);case"none":return this.removeTone(t);default:return t}}static isValidPinyin(t){if(!t||"string"!=typeof t)return!1;return/^[a-zA-ZāáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜüÜvV]+[1-5]?$/.test(t)}static getInitial(t){if(!t)return"";return this.removeTone(t).charAt(0).toUpperCase()}static comparePinyin(t,n){if(!t||!n)return!1;return this.removeTone(t.toLowerCase())===this.removeTone(n.toLowerCase())}}class i{constructor(){this.dataLoaded=!1,this.dataLoader=n.getInstance()}async initialize(){this.dataLoaded||(await this.dataLoader.loadData(),this.dataLoaded=!0)}convert(t,n={}){if(!this.dataLoaded)throw new Error("PinyinConverter not initialized. Call initialize() first.");const e=[],i=Array.from(t);for(const t of i){const i=this.convertChar(t,n);e.push(i)}return e}convertToString(t,n={}){var e;const i=this.convert(t,n),r=null!==(e=n.separator)&&void 0!==e?e:" ";return i.map(t=>n.heteronym&&t.isHeteronym?t.pinyin.join(","):t.pinyin[0]).join(r)}getHeteronyms(t){if(!this.dataLoaded)throw new Error("PinyinConverter not initialized. Call initialize() first.");if(!this.isChinese(t))return[];const n=this.dataLoader.charToUnicode(t),e=this.dataLoader.getData()[n]||[];return[...new Set(e)]}isChinese(t){return this.dataLoader.isChinese(t)}getAvailablePinyins(){if(!this.dataLoaded)throw new Error("PinyinConverter not initialized. Call initialize() first.");const t=this.dataLoader.getData(),n=new Set;for(const e of Object.values(t))e.forEach(t=>n.add(t));return Array.from(n).sort()}convertChar(t,n){const i={keepTone:!0,toneStyle:"mark",heteronym:!1,separator:" ",lowercase:!1,nonChinese:"keep",replaceChar:"",...n};if(!this.isChinese(t))return this.handleNonChinese(t,i);const r=this.dataLoader.charToUnicode(t),a=this.dataLoader.getData()[r]||[];if(0===a.length)return{origin:t,pinyin:[t],isHeteronym:!1};let o=a.map(t=>{let n=e.formatPinyin(t,i.toneStyle);return i.lowercase&&(n=n.toLowerCase()),n});return o=[...new Set(o)],{origin:t,pinyin:o,isHeteronym:o.length>1}}handleNonChinese(t,n){switch(n.nonChinese){case"remove":return{origin:t,pinyin:[""],isHeteronym:!1};case"replace":return{origin:t,pinyin:[n.replaceChar||""],isHeteronym:!1};default:return{origin:t,pinyin:[t],isHeteronym:!1}}}getInitials(t,n={}){return this.convert(t,n).map(t=>t.pinyin[0]&&e.isValidPinyin(t.pinyin[0])?e.getInitial(t.pinyin[0]):t.origin)}getInitialsString(t,n={}){var e;const i=this.getInitials(t,n),r=null!==(e=n.separator)&&void 0!==e?e:"";return i.join(r)}countChinese(t){return Array.from(t).filter(t=>this.isChinese(t)).length}getAllHeteronyms(t){const n=[],e=Array.from(t);for(const t of e)if(this.isChinese(t)){const e=this.getHeteronyms(t);e.length>1&&n.push({char:t,pinyins:e})}return n}}let r=null;async function a(){return r||(r=new i,await r.initialize()),r}async function o(t,n){return(await a()).convertToString(t,n)}"undefined"!=typeof window&&(window.PinyinConverter={PinyinConverter:i,getPinyinConverter:a,pinyin:o}),t.PinyinConverter=i,t.PinyinDataLoader=n,t.PinyinUtils=e,t.getPinyinConverter=a,t.pinyin=o});
//# sourceMappingURL=pinyin-converter.min.js.map
